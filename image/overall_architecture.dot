digraph DocuSnap_Backend_Architecture {
    // 图形属性
    rankdir=TB;
    fontname="Noto Sans SC";
    fontsize=16;
    bgcolor="white";
    margin=0.5;
    
    // 节点默认样式
    node [shape=box, style="rounded,filled", fontname="Noto Sans SC", fontsize=14, margin=0.3, color="#333333"];
    
    // 边默认样式
    edge [fontname="Noto Sans SC", fontsize=12, color="#666666"];
    
    // 客户端
    Client [label="客户端应用", fillcolor="#E6F2FF", shape=ellipse];
    
    // 系统边界
    subgraph cluster_docusnap_backend {
        label="DocuSnap-Backend 系统";
        style="rounded,filled";
        fillcolor="#F9F9F9";
        margin=16;
        
        // 后端服务器
        subgraph cluster_backend_server {
            label="后端服务器";
            style="rounded,filled";
            fillcolor="#E6F7FF";
            margin=12;
            
            API [label="API 层\n(Flask 路由)", fillcolor="#B3E0FF"];
            TaskProcessor [label="任务处理模块", fillcolor="#B3E0FF"];
            SecurityModule [label="安全加密模块", fillcolor="#B3E0FF"];
            
            API -> TaskProcessor [label="任务分发"];
            API -> SecurityModule [label="加密/解密"];
            SecurityModule -> API [label="加密响应"];
        }
        
        // 缓存服务器
        subgraph cluster_cache_server {
            label="缓存服务器";
            style="rounded,filled";
            fillcolor="#E6FFE6";
            margin=12;
            
            SQLiteDB [label="SQLite 数据库", fillcolor="#B3FFB3", shape=cylinder];
            CacheModule [label="缓存和数据持久化模块", fillcolor="#B3FFB3"];
            
            CacheModule -> SQLiteDB [label="读/写"];
        }
        
        // 模块间关系
        API -> CacheModule [label="查询/存储"];
        TaskProcessor -> CacheModule [label="存储结果"];
    }
    
    // 外部服务
    subgraph cluster_external_services {
        label="外部服务";
        style="rounded,filled";
        fillcolor="#FFF0E6";
        margin=16;
        
        // OCR 服务器
        subgraph cluster_ocr_server {
            label="OCR 服务器";
            style="rounded,filled";
            fillcolor="#FFE6CC";
            margin=12;
            
            OCRModule [label="OCR 处理模块", fillcolor="#FFCC99"];
            CnOCR [label="CnOCR 服务", fillcolor="#FFCC99", shape=component];
            
            OCRModule -> CnOCR [label="图像识别请求"];
            CnOCR -> OCRModule [label="文本结果"];
        }
        
        // LLM 提供商
        subgraph cluster_llm_provider {
            label="LLM 提供商";
            style="rounded,filled";
            fillcolor="#F2E6FF";
            margin=12;
            
            LLMModule [label="LLM 处理模块", fillcolor="#E6CCFF"];
            ZhipuAI [label="智谱 AI", fillcolor="#E6CCFF", shape=component];
            
            LLMModule -> ZhipuAI [label="提示请求"];
            ZhipuAI -> LLMModule [label="分析结果"];
        }
    }
    
    // 系统间关系
    Client -> API [label="加密请求"];
    API -> Client [label="加密响应"];
    TaskProcessor -> OCRModule [label="图像处理"];
    OCRModule -> TaskProcessor [label="文本结果"];
    TaskProcessor -> LLMModule [label="文本分析"];
    LLMModule -> TaskProcessor [label="结构化数据"];
    
    // 图例
    subgraph cluster_legend {
        label="图例";
        style="rounded,filled";
        fillcolor="white";
        margin=8;
        
        legend_client [label="客户端", fillcolor="#E6F2FF", shape=ellipse];
        legend_module [label="处理模块", fillcolor="#B3E0FF"];
        legend_service [label="外部服务", fillcolor="#FFCC99", shape=component];
        legend_db [label="数据存储", fillcolor="#B3FFB3", shape=cylinder];
        
        legend_client -> legend_module [style=invis];
        legend_module -> legend_service [style=invis];
        legend_service -> legend_db [style=invis];
    }
}